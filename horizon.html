<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>스브스 시점으로 본 대한민국 하늘(feat.미세먼지)</title>
    <meta property="og:image" content="./img/title.jpg">
    <link rel="stylesheet" type="text/css" href="css/semantic.css">
    <link rel="stylesheet" type="text/css" href="css/template.css">
    <link rel="stylesheet" type="text/css" href="css/style.css">
    <link href="css/twentytwenty.css" rel="stylesheet" type="text/css" />
    <script src="d3v4.js"></script>
    <script src="https://code.jquery.com/jquery-1.12.4.js"></script>
    <style>
    .container {
      position:relative;
      overflow:hidden;

    }
    .itemcontainer{
      overflow-x: scroll;
      scroll-snap-type: x mandatory;
      overflow-y: hidden;
      white-space: nowrap;
    }
    .container::-webkit-scrollbar {
    display: none;
    }
    .flexitem {
      width:80vw;
      height:80vh;
      display: inline-block;
      scroll-snap-align: center;
      /* z-index:0; */
      box-shadow:none;
      opacity: .5;
      transition:all .5s;
    }
    .flexitem.active{
      transition: all .5s;
      /* z-index:999; */
      opacity: 1;
    }   
    .itemcontainer {
    -webkit-overflow-scrolling: touch;
    }
    ::-webkit-scrollbar {
        display: none;
      }

    /* .......... */
    .date{
            height:5%;
            overflow:visible !important;
            text-align: right;
        }
        .date span{
            font-size:16px;
        }
        .picture{
            width:100%;
            height:40%;
            overflow:hidden;
            box-shadow:none;
            z-index: initial;
        }

        .picture img{
            height:99%;
        }
        .Palette{
            /* position:absolute;
            bottom:0; */
            width:100%;
            height:20%;
            /* margin-top:3px; */
        }
        .Palette div{
            width:100%;
            height:100%
            /* height:20%; */
        }
        .pm25{
            height:30%;
            width:100%;
            /* margin:0 1px; */
            /* background-color:#ddd; */
            position:relative;
        }
        .pm25bar{
            width:100%;
            position:absolute;
            bottom:0;
            background-color:#888;
        }
        .pm25bar span{
            position:absolute;
            top:-30px;
            right:0;
            background-color:#000;
            padding:0 10px;
            color:#fff;
            font-weight: bold;
        }
        .baraxis{
            height:5%;
            position:relative;
        }
        .baraxis span{
            position:absolute;
            right:0;
            font-weight: bold;
        }
        .label{
            position:absolute;
            left:10vw;
            background-color:#000;
            color:#fff;
            font-size:.7em;
        }
        .axis{
            height:30%;
            width:100%;
            position:absolute;
            top:65%;
        }
        .axisline{
            height:1px;
            position: absolute;
            bottom:34px;
            z-index:999;
            border-top:1px solid #f00;
        }
        .axisline span{
            display:block;
            position:absolute;
            top:0;
            left:10vw;
            background-color:#f00;
            color:white;
            font-size: .7em;
        }

        h2{
            margin:20px 20px;
        }
    </style>
</head>
<body>
        <header id="headerbar">
                <a href="http://news.sbs.co.kr/"><img src="./img/logo.png" alt="" class="sbslogo"></a>
                <a href="http://news.sbs.co.kr/news/newsPlusList.do?themeId=10000000114"><img src="./img/mabulogo.png" alt="" class="mabulogo"> </a>
                <img src="http://img.sbs.co.kr/newimg/news/20170406/201037558.png" alt="" class="social" id="twitter">
                <img src="http://img.sbs.co.kr/newimg/news/20170406/201037559.png" alt="" class="social" id="facebook">
            </header>
            <div id="progress">
                <div id="bar"></div>
            </div>
            <a class="intro">
                    <img src="test.png" alt="">
                    <a data-scroll class="scrolldown" href="#section1">
                        <img src="down.gif" alt="">
                    </a>    
                </div>
                <div class="article" id="section1">
                    <div class="content">
                    <p>
                        2019년 3월 5일. 최악의 초미세먼지(PM 2.5)가 한반도를 덮쳤습니다. 이날 서울의 하루 평균 초미세먼지 농도는 137㎍/㎥, 2015년 초미세먼지 농도를 공식 관측한 이후 역대 최고치를 5기록했습니다. 수도권에 3월 1일부터 7일 연속 고농도 초미세먼지 비상저감조치가 시행된 것도 사상 최초입니다.
                        <br><br>
                        SBS 데이터저널리즘팀 <마부작침>은 최근 1년간(2018.3.11~2019.3.10) 대한민국 서울의 하늘 영상을 모았습니다. 영상의 출처는 SBS 12시 뉴스로, 남북정상회담 등 대형이벤트로 뉴스가 결방된 날을 제외하면 영상은 350개입니다. 이를 서울의 일평균 초미세먼지 농도와 함께 비교해서 볼 수 있게 시각화했습니다.
                        <br>
                        (매일 정오 방송되는 SBS 12시 뉴스는 뉴스 말미에 SBS 목동사옥 옥상에 설치된 카메라로 서울 하늘을 실시간으로 보여줍니다.)
                        <br><br>
                        <마부작침>은 또 각 영상의 대표 색을 추출해 그날의 하늘을 색상 하나로 표현했습니다.  
                        <br><br>
                        *그래픽 감상법<br>
                        아래 영상은 2018.3.11~2019.3.10 서울 SBS 목동사옥 주변의 하늘을 촬영한 것입니다. 아무 곳이나 클릭하면 확대됩니다. 개별 영상을 클릭하면 최대 크기로 볼 수 있습니다. 또한 마우스 휠을 앞으로 굴리면 확대, 뒤로 굴리면 축소해서 볼 수 있습니다. 그 아래 막대 차트는 같은 기간 서울의 일평균 초미세먼지 농도를 가리킵니다. 마우스로 클릭하면 그날의 초미세먼지 농도가 얼마였는지 확인할 수 있습니다
            
                    </p>
                    </div>
                </div>
                <div class="articlefull" id="section2">
                <input type="range" min="0" max="364" value="0" class="slider" id="myRange">
                <div class="container">
                    <!-- <div class="label skypic">하늘사진</div>
                    <div class="label color">하늘 대표 색상값</div>
                    <div class="label graph">초미세먼지 농도 그래프</div> -->
                </div>
                </div>
                <div class="article" id="section3">
                    <div class="content">
                    <p>
                            매일 정오 방송하는 SBS 12시 뉴스는, 뉴스 말미에 SBS 옥상에 설치된 카메라를 통해 서울 하늘을 실시간으로 보여줍니다. 카메라가 동쪽을 비추면 목동운동장과 국회의사당, 남산서울타워 등이 볼 수 있고, 북쪽을 비추면 성산대교를 내다볼 수 있습니다.  
                    </p>
                    <div class="imgsection">
                        <div class="map"><img src="map.png" alt=""></div>
                        <div class="cam"><img src="news.gif" alt="" srcset=""><div class="camnum">12시 뉴스 영상</div></div>
                        <!-- <div class="cam"><img src="img/east.png" alt="" srcset=""><div class="camnum">카메라②</div></div> -->
                    </div>
                    <p>
                            카메라는 서울 양천구 목동 SBS 본사 옥상에 고정돼 있습니다. 카메라가 동쪽을 찍으면 목동운동장과 국회의사당, 남산서울타워 등이 보이고, 북쪽을 찍으면 성산대교 등이 보입니다.
                    </p> 
                    </div>
                </div>
                <div class="article" id="section4">
                    <div class="content">
                    <div class="title">남산타워가 사라진 날... 초미세먼지와 가시거리
                        </div>
                    <div id="diff">
                        <img src="img/good.png">
                        <img src="img/bad.png">
                    </div>
                    <p class="explain">*화면 중앙의 버튼을 마우스로 클릭하고 오른쪽으로 이동하면 2018년 7월 7일, 왼쪽으로 이동하면 2019년 3월 4일의 하늘을 볼 수 있습니다.
                    </p>
                    <p>     
                        청명한 날과 미세먼지 가득한 날의 가시거리 차이는 상당합니다. 초미세먼지(PM 2.5) 농도가 높아지면 빛이 미세먼지에 의해 여러 방향으로 흩어지거나, 미세먼지에 흡수돼 가시거리가 감소합니다. 황산염, 질산염 등 초미세먼지 농도가 높은 상태에서 습도까지 높아지면 대기오염물질이 수분을 흡수해 가시거리는 더욱 짧아집니다. 물론 미세먼지 농도가 높을 때뿐 아니라 날씨가 흐리거나 안개 낀 날에도 가시거리는 짧아집니다. 
                        <br><br>
                        초미세먼지 일평균 농도 4㎍/㎥를 기록했던 2018년 7월 7일, SBS에서 직선거리 3.6km인 국회의사당은 물론, 10.4km 떨어진 남산서울타워까지 뚜렷하게 보입니다. 반면 일평균 농도 119㎍/㎥였던 2019년 3월 4일엔 국회의사당을 비롯해 강북 쪽 건물은 식별조차 되지 않습니다.
                    </p>
                    </div>
                </div>
                <div class="article" id="section5">
                    <div class="content">
                    <div class="title">초미세먼지(PM 2.5) '나쁨' 대 '좋음'</div>
                    <div class="imgsection2">
                    <div class="subtitle">나쁜 날</div>
                    <div class="top5">
                        <div class="imgpart2"><img src="img/top10/bad120190305.jpg" alt=""><div class="order">1</div><div class="info">2019년 3월 5일<div class="pm">137㎍/㎥</div></div></div>
                        <div class="imgpart2"><img src="img/top10/bad220190114.jpg" alt=""><div class="order">2</div><div class="info">2019년 1월 14일 <div class="pm">128㎍/㎥</div></div></div>
                        <div class="imgpart2"><img src="img/top10/bad320190304.jpg" alt=""><div class="order">3</div><div class="info">2019년 3월 4일<div class="pm">119㎍/㎥</div></div></div>
                        <div class="imgpart2"><img src="img/top10/bad420190306.jpg" alt=""><div class="order">4</div><div class="info">2019년 3월 6일<div class="pm">102㎍/㎥</div></div></div>
                        <div class="imgpart2"><img src="img/top10/bad520180325.jpg" alt=""><div class="order">5</div><div class="info">2018년 3월 25일<div class="pm">99㎍/㎥</div></div></div>
                    </div>
                    <div class="subtitle">좋은 날</div>
                    <div class="top5">
                        <div class="imgpart2"><img src="img/top10/good120180706.jpg" alt=""><div class="order">1</div><div class="info">2018년 7월 6일<div class="pm">3㎍/㎥</div></div></div>
                        <div class="imgpart2"><img src="img/top10/good220180707.jpg" alt=""><div class="order">2</div><div class="info">2018년 7월 7일<div class="pm">4㎍/㎥</div></div></div>
                        <div class="imgpart2"><img src="img/top10/good420180519.jpg" alt=""><div class="order">3</div><div class="info">2018년 5월 19일<div class="pm">5㎍/㎥</div></div></div>
                        <div class="imgpart2"><img src="img/top10/good920180926.jpg" alt=""><div class="order">4</div><div class="info">2018년 9월 26일<div class="pm">5㎍/㎥</div></div></div>
                        <div class="imgpart2"><img src="img/top10/good1020180927.jpg" alt=""><div class="order">5</div><div class="info">2018년 9월 27일<div class="pm">5㎍/㎥</div></div></div>
                    </div>
                    </div>
                        <p>                  
                            지난 1년간 서울의 초미세먼지 농도는 평균 25.8㎍/㎥를 기록했습니다.(2018.3.11~2019.3.10) 우리나라 대기환경기준에서 권고하는 연평균 25㎍/㎥ 이하를 살짝 넘겼고, WHO 권고기준인 10㎍/㎥의 2배가 넘습니다. 서울 양천구 측정소도 지난 1년간 평균 25.5㎍/㎥로 비슷한 수준입니다.
                        <br><br>
                            위 영상은 초미세먼지 농도가 가장 높았던 날과 가장 낮았던 날들입니다. 최악의 '나쁨'이었던 2019년 3월 5일은 137㎍/㎥, 최고의 '좋음'이었던 2018년 7월 6일은 3㎍/㎥로, 약 46배 차이를 보였습니다.
                        </p>
                    </div>
                </div>
                <div class="article" id="section6">
                    <div class="content">
                    <div class="title">닷새 중 하루는 숨 편히 쉬기 힘들었다... 달력으로 보는 서울 초미세먼지(PM 2.5)
                        </div>
                    <div class="imgcalendar"><img src="img/cal.png" alt="" srcset=""></div>
                    <p>
                        서울의 초미세먼지 농도가 '좋음'이었던 날은 지난 1년간 116일, '보통'은 171일이었고, '나쁨'은 67일, '매우 나쁨'은 11일이었습니다. 2018년 3월 11일부터 지난 3월 10일까지 365일 중 78일이 '나쁨' 이상으로, 닷새 중 하루 꼴로 숨 쉬기 힘든 날이었다는 게 기록으로 확인됩니다.
                        <br><br>
                        2018년에는 초미세먼지 '나쁨' 이상을 8일 연속 기록한 게 최장이었습니다. 2018년 3월 23일부터 3월 30일까지입니다. 2019년에는 2월 27일부터 3월 7일까지 '나쁨' 이상이 9일 동안 이어졌습니다.
                        <br><br>              
                        세계보건기구(WHO) 기준으로 서울의 초미세먼지 농도를 살펴보면 더욱 심각합니다. WHO의 일평균 권고기준은 25㎍/㎥ 이하, 이 수준을 유지해야 초미세먼지로 인한 사망률 증가를 막을 수 있다는 의미입니다. 지난 1년간 WHO의 기준을 만족하지 못한 날은 총 140일. 특히 2월과 3월은 한 달에 20일 이상씩 권고기준을 넘었습니다.
                    </p>
                    </div>
                </div>
            <footer id="footerbar">
                <div class="articlebox">
                    <a href="http://news.sbs.co.kr/news/newsPlusList.do?themeId=10000000114">
                        <p id="fteamname">SBS 데이터저널리즘팀 마부작침</p>
                    </a>
                    <br><br>
                    <p>
                    심영구 기자 (so5what@sbs.co.kr)<br>
                    김학휘 기자 (hwi@sbs.co.kr)<br>
                    안혜민 기자·분석가 (hyeminan@sbs.co.kr)<br>
                    조애리 디자이너·개발자 (dofl5576@gmail.com)<br>
                    인턴: 박지영</p>
                </div>
            </footer>
</body>
<!-- image compare -->
<script src="lib/jquery.event.move.js"></script>
<script src="lib/jquery.twentytwenty.js"></script>
<script>
$(window).load(function() {

    $("#diff").twentytwenty({
    default_offset_pct: 0.2, 
    before_label: 'January 2017',
    after_label: 'March 2017',
    no_overlay: true,

  });

    const datasize=365;
    const imagewidth=498;
    var margin = {top: 0, right: 20, bottom: 0, left: 20},
    width = window.innerWidth,
    height = window.innerHeight;

    const parseDate = d3.timeParse("%Y-%m-%d");
    const monthformat = d3.timeFormat('%_m월');
    const dayformat= d3.timeFormat('%y년 %_m월 %_d일');


    const container=d3.select('.container');

    d3.csv("data.csv", type, function(error, data) {
      if (error) throw error;
      
      container.append('div')
            .attr('class','axis')
            .style('top','65%');
        d3.select('.axis').append('div')
            .attr('class','axisline')
            .style('width',width+'px')
            .html("<span>'나쁨' 기준 (35㎍/㎥)</span>");


        container.append('div').attr('class','itemcontainer')
            .selectAll('div')
            .data(data)
            .enter()
            .append('div')
            .attr('class','flexitem')
            .attr('id',function(d,i){
                return 'item'+i;
            });
  
        const flexitem=d3.selectAll('.flexitem');

        flexitem.append('div')
            .attr('class','date')
            .html(function(d,i){
                if(d.pm25<16){
                    return "<span class='status'>&#x1F606; 좋음</span>"
                }else if(d.pm25>=16 && d.pm25<36){
                    return "<span class='status'>&#x1F644; 보통</span>"
                }else if(d.pm25>=36 && d.pm25<76){
                    return "<span class='status'>&#x1F61F; 나쁨</span>"
                }else{
                    return "<span class='status'>&#x1F631; 매우 나쁨</span>"
                }
            });
        
        const picture=flexitem.append('div')
            .attr('class',function(d){
                return 'picture';
            })    
    
        picture.append('img')
            .attr('src',function(d,i){
            return 'image/img'+(i+1)+'.png';
                // return 'sky.jpg'
            })

        flexitem.append('div')
            .attr('class','Palette')
            .attr('id',function(d,i){
                return 'palette'+i;
            })
            .style('background-color',function(d){
                if(d.R==''){
                    d3.select(this).style('background-image','url("line.png")');
                }else{
                return 'rgb('+d.R+','+d.G+','+d.B+')';
                }
            })

        const bar=flexitem.append('div')
            .attr('class','pm25')
            .attr('id',function(d,i){
                return 'pm25'+i;
            })
        bar.append('div')
            .attr('class','pm25bar')
            .attr('id',function(d,i){
                return 'pm25bar'+i;
            })
        d3.selectAll('.pm25bar')
            .style('height',function(d){
                return d.pm25+'px';
            });

       var baraxis = flexitem.append('div')
            .attr('class','baraxis')
            .html(function(d,i){
                // if(i%30==1)
                return '<span>'+dayformat(parseDate(d.date))+'</span>';
            });
            d3.selectAll('.pm25bar').html(function(d,i){
            return '<span>'+d.pm25+'</span>';
            });
    container.append('div')
            .attr('class','label')
            .style('top','5%')
            .html('하늘 사진');
    container.append('div')
            .attr('class','label')
            .style('top','45%')
            .html('하늘 색상 추출');
    container.append('div')
            .attr('class','label')
            .style('top','65%')
            .html('PM2.5 초미세 먼지 수치');

            var cards=$('.flexitem');
            var slider = document.getElementById("myRange");
                slider.addEventListener('input', function(){
                    var val=this.value;  
                    var $section = $('#item'+val); 
                    $('.itemcontainer').scrollLeft($section.offset().left); 
                });

            $('.itemcontainer').scroll(function(){
              cards.each(function(){       
                var offset=$(this).offset();
                if(offset.left>-window.innerWidth/2 && offset.left<window.innerWidth/2){
                    $(this).addClass( 'active' );
                    slider.value=$(this).index();
                    console.log($(this).select('.pm25bar'))
                }else{
                  $(this).removeClass( 'active' );
                }
              })

            })

    });


    function type(d) {
        d.pm25 = +d.pm25;
        return d;
    }
    
    
  });   

</script>
</html>